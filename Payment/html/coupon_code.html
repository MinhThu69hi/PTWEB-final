<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mã Ưu Đãi</title>
    <!-- Đường dẫn CSS chính xác -->
    <link rel="stylesheet" href="../css/coupon_code.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* CSS cho hiệu ứng khi chọn voucher */
        .voucher-item.selected {
            border: 2px solid #3b82f6;
            background-color: #f0f5ff;
        }
        .voucher-item.selected .voucher-select {
            background-color: #3b82f6;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>');
            background-size: 60%;
            background-repeat: no-repeat;
            background-position: center;
        }
    </style>
</head>
<body>

    <div class="promo-modal">
        <header class="modal-header">
            <h2>MÃ ƯU ĐÃI</h2>
            <button class="close-button"></button>
        </header>

        <main class="modal-body">
            <div class="input-section">
                <input type="text" placeholder="Nhập mã ưu đãi">
                <button class="apply-button">ÁP DỤNG</button>
            </div>

            <div class="voucher-list">
                <div class="category-tag">Lựa chọn tốt nhất</div>
                <!-- ĐÃ THÊM: data attributes để lưu thông tin voucher -->
                <div class="voucher-item" data-code="BANMOI80" data-discount="80000" data-title="Voucher 80K" data-desc="Giảm 80k cho đơn Online đầu tiên từ 399k">
                    <div class="voucher-details">
                        <h3>Voucher 80K</h3>
                        <p>Giảm 80k cho đơn Online đầu tiên từ 399k</p>
                        <p>Mã: <strong>BANMOI80</strong></p>
                        <p>HSD: 2025-12-31</p>
                        <a href="#" class="conditions-link">Điều kiện</a>
                    </div>
                    <div class="voucher-select"></div>
                </div>

                <div class="category-tag">Ưu đãi riêng bạn</div>
                <!-- ĐÃ THÊM: data attributes -->
                <div class="voucher-item" data-code="GIAM50" data-discount="50000" data-title="Voucher 50K" data-desc="Giảm 50k cho đơn từ 299k">
                    <div class="voucher-details">
                        <h3>Voucher 50K</h3>
                        <p>Giảm 50k cho đơn từ 299k</p>
                        <p>Mã: <strong>GIAM50</strong></p>
                        <p>HSD: 2025-10-31</p>
                        <a href="#" class="conditions-link">Điều kiện</a>
                    </div>
                    <div class="voucher-select"></div>
                </div>
            </div>
        </main>

        <footer class="modal-footer">
            <button class="apply-button primary" id="confirm-apply">ÁP DỤNG</button>
        </footer>
    </div>

    <!-- === JAVASCRIPT ĐÃ ĐƯỢC NÂNG CẤP === -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Xử lý nút đóng modal
            const closeButton = document.querySelector('.close-button');
            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    // Quay về trang trước đó mà không áp dụng voucher
                    window.history.back();
                });
            }

            // Xử lý việc chọn voucher
            const voucherItems = document.querySelectorAll('.voucher-item');
            voucherItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Bỏ chọn tất cả các voucher khác
                    voucherItems.forEach(v => v.classList.remove('selected'));
                    // Chọn voucher này
                    this.classList.add('selected');
                });
            });

            // Xử lý nút "ÁP DỤNG" chính
            const confirmApplyBtn = document.getElementById('confirm-apply');
            if (confirmApplyBtn) {
                confirmApplyBtn.addEventListener('click', () => {
                    const selectedVoucherEl = document.querySelector('.voucher-item.selected');
                    
                    if (selectedVoucherEl) {
                        // Nếu có voucher được chọn, thu thập thông tin từ data attributes
                        const voucherData = {
                            code: selectedVoucherEl.dataset.code,
                            discount: parseInt(selectedVoucherEl.dataset.discount),
                            title: selectedVoucherEl.dataset.title,
                            desc: selectedVoucherEl.dataset.desc
                        };
                        // Lưu đối tượng voucher vào sessionStorage
                        sessionStorage.setItem('selectedVoucher', JSON.stringify(voucherData));
                    } else {
                        // Nếu người dùng không chọn voucher nào mà bấm áp dụng,
                        // chúng ta sẽ xóa thông tin voucher cũ (nếu có)
                        sessionStorage.removeItem('selectedVoucher');
                    }

                    // Điều hướng về trang thanh toán
                    window.location.href = 'update_order_information.html';
                });
            }
        });
    </script>
</body>
</html>